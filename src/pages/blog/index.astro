---
import { getCollection } from 'astro:content';
import BlogLayout from '../../layouts/BlogLayout.astro';
import SearchBar from '../../components/SearchBar.astro';
import PostList from '../../components/PostList.astro';
import Pagination from '../../components/Pagination.astro';
import SearchScript from '../../components/SearchScript.astro';
import { SITE_TITLE } from '../../consts';
import { getPaginatedPosts, getTotalPages, sortPostsByDate } from '../../lib/pagination';

const allPosts = sortPostsByDate(await getCollection('blog'));
const currentPage = 1;
const totalPages = getTotalPages(allPosts.length);
const posts = getPaginatedPosts(allPosts, currentPage);
---

<BlogLayout title={SITE_TITLE} description="全ての投稿">
  <SearchBar 
    totalPosts={allPosts.length}
    currentPage={currentPage}
    totalPages={totalPages}
  />

  <div class="layout">
    <PostList posts={posts} title="Posts" />

    <article class="panel" aria-label="Post detail">
      <div class="content">
        <div class="empty">投稿を選んでね。</div>
      </div>
    </article>
  </div>

  <Pagination 
    currentPage={currentPage}
    totalPages={totalPages}
    baseUrl="/blog"
  />

  <SearchScript />
</BlogLayout>
